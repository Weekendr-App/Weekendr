import Head from "next/head";
import { lazy, Suspense, useState } from "react";
import { Spinner } from "@diplomski/components/Spinner";
import { Props as VenueListItemProps } from "@diplomski/components/Venue/VenueListItem";
import { useMediaQuery } from "usehooks-ts";

const Map = lazy(() => import("@diplomski/components/Map"));
const VenueListItem = lazy(
  () => import("@diplomski/components/Venue/VenueListItem")
);

export default function Home() {
  const isPhone = useMediaQuery("(max-width: 640px)");
  const [visibleVenues, setVisibleVenues] = useState<
    VenueListItemProps["venue"][]
  >([]);

  return (
    <>
      <Head>
        <title>Home Page</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Suspense fallback={<Spinner />}>
        <div className="sm:flex text-white">
          <div
            className="sm:w-1/2 w-full p-2 overflow-y-auto"
            style={{ height: isPhone ? "calc((100vh / 2) - 32px)" : "auto" }}
          >
            <h2 className="text-2xl font-bold mb-2">
              Venues currently visible on map
            </h2>
            <div className="flex flex-col gap-2">
              {visibleVenues.length > 0 ? (
                visibleVenues.map((venue) => (
                  <VenueListItem key={venue.id} venue={venue} />
                ))
              ) : (
                <span className="text-gray-500">No venues visible</span>
              )}
            </div>
          </div>
          <div className="w-full sm:w-1/2">
            <Map onChangeVisibleVenues={setVisibleVenues} />
          </div>
        </div>
      </Suspense>
    </>
  );
}
